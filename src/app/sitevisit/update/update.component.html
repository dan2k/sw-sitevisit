<div class="row">
  <br><br><br>
    <div class="root" style="width:100%;overflow-x:auto;">
      <ul class="progressbar">
        <li [ngClass]="{'active':detail.sw_status>=0}"   [matTooltip]="'โดย: '+detail.cdg_name"    [matTooltipDisabled]="false">รอเสนออนุมัติ</li>
        <li [ngClass]="{'active':detail.sw_status>=0}"   [matTooltip]="'โดย: '+detail.bug_name"    [matTooltipDisabled]="false" *ngIf="(detail.sw_status==101)">send bug</li>
        <li [ngClass]="{'active':detail.sw_status>=1}"   [matTooltip]="'โดย: '+detail.cdg_name"    [matTooltipDisabled]="!(detail.sw_status>=1)">SW ภาคเสนออนุมัติ</li>
        <li [ngClass]="{'active':detail.sw_status>=2}"   [matTooltip]="'โดย: '+detail.mts_name"    [matTooltipDisabled]="!(detail.sw_status>=2)" *ngIf="(detail.sw_status<6)">MTS เสนออนุมัติ</li>
        <li [ngClass]="{'active':detail.sw_status>=2}"   [matTooltip]="'โดย: '+detail.dup_name"    [matTooltipDisabled]="!(detail.sw_status>=2)" *ngIf="(detail.sw_status==102)">MTS dup</li>
        <!-- <li [ngClass]="{'active':detail.sw_status>=2}"   [matTooltip]="'โดย: '+detail.dup_name"    [matTooltipDisabled]="!(detail.sw_status>=2)" *ngIf="(detail.sw_status==99 && (detail.sw_mts_approveid==''||detail.sw_mts_approveid==null))">no approve</li> -->
        <li [ngClass]="{'active':detail.sw_status>=3}"   [matTooltip]="'โดย: '+detail.cdg_name"    [matTooltipDisabled]="!(detail.sw_status>=3)" *ngIf="(detail.sw_status<6)">SW บันทึกนำเสนอภาค</li>
        <!-- <li [ngClass]="{'active':detail.sw_status>=2}"   [matTooltip]="'โดย: '+detail.dup_name"    [matTooltipDisabled]="!(detail.sw_status>=4)" *ngIf="(detail.sw_status==99 && (detail.sw_rg_approveid==''||detail.sw_rg_approveid==null))">no approve</li> -->
        <li [ngClass]="{'active':detail.sw_status>=4}"   [matTooltip]="'โดย: '+detail.rg_name"     [matTooltipDisabled]="!(detail.sw_status>=4)" *ngIf="(detail.sw_status<6)">วิชาการภาคเสนออนุมัติ</li>
        <li [ngClass]="{'active':detail.sw_status>=5}"   [matTooltip]="'โดย: '+detail.center_name" [matTooltipDisabled]="!(detail.sw_status>=5)" *ngIf="(detail.sw_status<6)">วิชาการกลางเสนออนุมัติ</li>
        </ul>
    </div>
</div>
<!---##########################################################################-->
<mat-card class="example-card">
  <mat-card-header>
    <mat-card-title>หน่วยงาน: {{detail?.place}}</mat-card-title>
    <mat-card-subtitle>
      ระบบงาน/โปรแกรม: {{detail?.prob_gdesc}}/{{detail?.problem_sub_desc}}
      <br>
      วันที่:{{detail?.visit_date}}
      <br>
      เจ้าหน้าที่:{{detail?.cust_name}}
      <br>
      พนักงาน:{{detail?.cdg_name}}
    </mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <form #f="ngForm">
      <mat-form-field style="width:95%">
        <textarea matInput placeholder="รายละเอียด" #sw_detail="ngModel" name="sw_detail" [(ngModel)]="detail.sw_detail"
          [disabled]="detail.sw_status!=0 || !(user.upd_permit==1 && user.level.indexOf('1')>-1) || isupdate " required></textarea>
        <mat-error *ngIf="sw_detail.invalid&&(sw_detail.dirty||sw_detail.touched)">กรุณาระบุรายละเอียด</mat-error>
        <!-- <span>{{sw_detail.invalid+','+sw_detail.dirty+','+sw_detail.touched}}</span> -->
      </mat-form-field>
      <mat-form-field style="width:95%">
        <textarea matInput placeholder="ข้อเสนอแนะ"
          #sw_suggestion="ngModel"
          name="sw_suggestion"
          [(ngModel)]="detail.sw_suggestion"
          [disabled]="detail.sw_status!=0 || !(user.user_id==detail.sw_emp && user.upd_permit==1 && user.level.indexOf('1')>-1) || isupdate" required></textarea>
        <mat-error *ngIf="sw_suggestion.invalid&&(sw_suggestion.dirty||sw_suggestion.touched)">กรุณาระบุข้อเสนอแนะ</mat-error>
        <span style="font-size:10px;"
          [hidden]="detail.sw_filedoc===null||detail.sw_filedoc===''">
          <a (click)="open(detail.sw_filedoc)"  mat-button color="accent">เอกสารแนบ</a>
            <a mat-button color="warn"
            *ngIf="(detail.sw_status==='0' && user.user_id===detail.sw_emp && user.upd_permit===1 && user.level.indexOf('1')>-1) || isupdate"
            (click)="del(detail.sw_filedoc)">ลบ</a>
        </span>
      </mat-form-field>
      <mat-form-field style="width:95%">
        <textarea matInput placeholder="ข้อเสนอแนะหลังจากสรุปกับ MTS"
          (click)="autoDetailsw()"
          #sw_mts_remark="ngModel"
          name="sw_mts_remark"
          [(ngModel)]="detail.sw_mts_remark"
          [disabled]="detail.sw_status!=2 || !(user.upd_permit==1 && user.level.indexOf('1')>-1)  || isupdate"></textarea>
        <span style="font-size:10px;" [hidden]="detail.sw_mts_filedoc===null||detail.sw_mts_filedoc===''">
          <a (click)="open(detail.sw_mts_filedoc)"   mat-button color="accent">เอกสารแนบ</a>
          <a mat-button color="warn"
            *ngIf="detail.sw_status!=2|| !(user.upd_permit==1 && user.level.indexOf('1')>-1) || isupdate"
            (click)="del(detail.sw_mts_filedoc)">ลบ</a></span>
      </mat-form-field>
      <mat-form-field style="width:95%">
          <textarea matInput placeholder="ข้อเสนอแนะวิชาการภาค"
            (click)="autoDetailrg()"
            #sw_rg_remark name="sw_rg_remark"
            [(ngModel)]="detail.sw_rg_remark"
            [disabled]="detail.sw_status!=3 || !(user.user_id==detail.sw_emp && user.upd_permit==1 && user.level.indexOf('2')>-1) || isupdate"></textarea>
          <span style="font-size:10px;" [hidden]="detail.sw_rg_filedoc===null||detail.sw_rg_filedoc===''">
            <a (click)="open(detail.sw_rg_filedoc)"
              mat-button color="accent">เอกสารแนบ</a>
            <a mat-button color="warn"
              *ngIf="detail.sw_status!=3 || !(user.user_id==detail.sw_emp && user.upd_permit==1 && user.level.indexOf('2')>-1) || isupdate"
                (click)="del(detail.sw_rg_filedoc)">ลบ</a></span>
        </mat-form-field>
      <mat-form-field style="width:95%">
        <textarea matInput placeholder="ข้อเสนอแนะวิชาการกลาง"
          #sw_center_remark
          (click)="autoDetailcenter()"
          name="sw_center_remark"
          [(ngModel)]="detail.sw_center_remark"
          [disabled]="detail.sw_status!=4 || !(user.upd_permit==1 && user.level.indexOf('4')>-1) || isupdate"></textarea>
        <span style="font-size:10px;" [hidden]="detail.sw_center_filedoc===null||detail.sw_center_filedoc===''">
          <a (click)="open(detail.sw_center_filedoc)" mat-button color="accent">เอกสารแนบ</a>
          <a mat-button color="warn"
            *ngIf="detail.sw_status!=4 || !(user.upd_permit==1 && user.level.indexOf('4')>-1) || isupdate"
            (click)="del(detail.sw_center_filedoc)">ลบ</a></span>
      </mat-form-field>
    </form>
  </mat-card-content>
  <mat-card-actions>
    <button type="button" mat-button color="warn"
      (click)="file.click()"
      [disabled]="f.invalid || detail.sw_status!=0 || isupdate"
      *ngIf="(user.upd_permit==1 && user.level.indexOf('1')>-1) && detail.sw_status==0">
      <mat-icon>file_upload</mat-icon>
      upload
    </button>
    <!-- <button type="button" mat-button color="warn"
      (click)="file.click()"
      [disabled]="f.invalid || detail.sw_status!=1 || isupdate"
      *ngIf="(user.upd_permit==1 && user.level.indexOf('3')>-1) && detail.sw_status==1">
      <mat-icon>file_upload</mat-icon>
      upload
    </button> -->
    <button type="button" mat-button color="warn"
      (click)="file.click()"
      [disabled]="f.invalid || detail.sw_status!=2 || isupdate"
      *ngIf="(user.upd_permit==1 && user.level.indexOf('1')>-1) && detail.sw_status==2">
      <mat-icon>file_upload</mat-icon>
      upload
    </button>
    <button type="button" mat-button color="warn"
      (click)="file.click()"
      [disabled]="f.invalid || detail.sw_status!=3 || isupdate"
      *ngIf="(user.upd_permit==1 && user.level.indexOf('2')>-1) && detail.sw_status==3">
      <mat-icon>file_upload</mat-icon>
      upload
    </button>
    <button type="button" mat-button color="warn"
      (click)="file.click()"
      [disabled]="f.invalid || detail.sw_status!=4 || isupdate"
      *ngIf="(user.upd_permit==1 && user.level.indexOf('4')>-1) && detail.sw_status==4">
      <mat-icon>file_upload</mat-icon>
      upload
    </button>
    <span *ngIf="!(user.level.indexOf('3')>-1)"><b>file:&nbsp;</b>{{filedoc}}</span>
    <input type="file" #file style="display:none;" accept="image/*,application/pdf" (change)="upload(file)">
  </mat-card-actions>
  <mat-card-footer>
    <button mat-flat-button color="primary"
      [disabled]="f.invalid || !(user.user_id==detail.sw_emp) || detail.sw_status!=0 || isupdate"
      *ngIf="(user.upd_permit==1 && user.level.indexOf('1')>-1) && detail.sw_status==0"
      (click)="update('1')">ปรับปรุง</button>
    <!-- <button mat-flat-button color="primary"
      [disabled]="f.invalid || detail.sw_status!=1 || isupdate"
      *ngIf="(user.upd_permit==1 && user.level.indexOf('3')>-1) && detail.sw_status==1"
      (click)="update('2')">ปรับปรุง</button> -->
    <button mat-flat-button color="primary"
      [disabled]="f.invalid || detail.sw_status!=2 || isupdate"
      *ngIf="(user.upd_permit==1 && user.level.indexOf('1')>-1) && detail.sw_status==2"
      (click)="update('3')">ปรับปรุง</button>
    <button mat-flat-button color="primary"
      [disabled]="f.invalid || detail.sw_status!=3 || isupdate"
      *ngIf="(user.upd_permit==1 && user.level.indexOf('2')>-1) && detail.sw_status==3"
      (click)="update('4')">ปรับปรุง</button>
    <button mat-flat-button color="primary"
      [disabled]="f.invalid || detail.sw_status!=4 || isupdate"
      *ngIf="(user.upd_permit==1 && user.level.indexOf('4')>-1) && detail.sw_status==4"
      (click)="update('5')">ปรับปรุง</button>


    <button mat-flat-button color="accent"
      [disabled]="detail.sw_status!=0 || !(user.user_id==detail.sw_emp) || isapprove"
      *ngIf="(user.upd_permit==1 && user.level.indexOf('1')>-1) && detail.sw_status==0"
      (click)="approve('1')">เสนออนุมัติ</button>
    <button mat-flat-button color="accent"
      [disabled]="detail.sw_status!=1 || isapprove"
      *ngIf="(user.upd_permit==1 && user.level.indexOf('3')>-1) && detail.sw_status==1"
      (click)="approve('2')">เสนออนุมัติ</button>
    <button mat-flat-button color="accent"
      [disabled]="detail.sw_status!=2 || isapprove"
      *ngIf="(user.upd_permit==1 && user.level.indexOf('1')>-1) && detail.sw_status==2"
      (click)="approve('3')">เสนออนุมัติ</button>
    <button mat-flat-button color="accent"
      [disabled]="detail.sw_status!=3 || isapprove"
      *ngIf="(user.upd_permit==1 && user.level.indexOf('2')>-1) && detail.sw_status==3"
      (click)="approve('4')">เสนออนุมัติ</button>
    <button mat-flat-button color="accent"
      [disabled]="detail.sw_status!=4 || isapprove"
      *ngIf="(user.upd_permit==1 && user.level.indexOf('4')>-1) && detail.sw_status==4"
      (click)="approve('5')">เสนออนุมัติ</button>
    <button mat-flat-button color="accent"
        (click)="bug(detail.sw_no)"
        *ngIf="(detail.sw_status==0 && user.upd_permit==1 && detail.sw_emp==user.user_id && user.level.indexOf('1')>-1)"><mat-icon >bug_report</mat-icon></button>
    <button mat-flat-button color="accent"
        (click)="noapprove()"
        *ngIf="(detail.sw_status==1 && user.level.indexOf('3')>-1) || (detail.sw_status==3 && user.level.indexOf('2')>-1) || (detail.sw_status==4  && user.level.indexOf('4')>-1)"
        ><mat-icon >delete</mat-icon></button>
    <button mat-flat-button color="accent"
        (click)="dup()"
        *ngIf="(detail.sw_status==1 && user.upd_permit==1 && user.level.indexOf('3')>-1)"><mat-icon >control_point_duplicate</mat-icon></button>
    <button mat-flat-button color="primary" (click)="print()"><mat-icon >print</mat-icon></button>

    <button mat-flat-button color="warn" (click)="back()">ปิด</button>
  </mat-card-footer>
</mat-card>

